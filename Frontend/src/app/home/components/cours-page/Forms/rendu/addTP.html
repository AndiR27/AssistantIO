<form [formGroup]="form" (ngSubmit)="onSubmit()" class="tp-form">

  <mat-form-field appearance="outline" class="full-width">
    <mat-label>Numéro du TP</mat-label>
    <input matInput type="number" id="noTp" formControlName="noTp" min="1" placeholder="Ex: 1, 2, 3..." />
    <mat-icon matPrefix>assignment</mat-icon>
    @if (form.controls.noTp.touched && form.controls.noTp.invalid) {
    <mat-error>Le numéro du TP est requis.</mat-error>
    }
  </mat-form-field>

  <div class="file-upload-section">
    <input type="file" id="zipFile" #fileInputRef (change)="onFileChange($event)" accept=".zip" hidden />

    <button mat-raised-button type="button" color="accent" class="choose-file-btn" (click)="fileInputRef.click()">
      <mat-icon>attach_file</mat-icon>
      <span>{{ file ? 'Changer de fichier' : 'Choisir un fichier .zip' }}</span>
    </button>

    @if (file) {
    <div class="file-info">
      <mat-chip class="file-chip">
        <mat-icon matChipAvatar>folder_zip</mat-icon>
        {{ file.name }}
      </mat-chip>
      <span class="file-size">{{ (file.size / 1024).toFixed(2) }} KB</span>
    </div>
    }
  </div>

  <div class="form-actions">
    <button mat-raised-button color="primary" class="submit-btn" type="submit"
      [disabled]="form.invalid || !file || isUploading">
      @if (isUploading) {
      <ng-container>
        <mat-icon class="spinning">sync</mat-icon>
        <span>Ajout en cours...</span>
      </ng-container>
      } @else {
      <ng-container>
        <mat-icon>add_circle</mat-icon>
        <span>Ajouter le TP</span>
      </ng-container>
      }
    </button>
  </div>

  @if (successMsg) {
  <div class="success-message">
    <mat-icon>check_circle</mat-icon>
    <span>{{ successMsg }}</span>
  </div>
  }

  @if (errorMsg) {
  <div class="error-message">
    <mat-icon>error</mat-icon>
    <span>{{ errorMsg }}</span>
  </div>
  }
</form>