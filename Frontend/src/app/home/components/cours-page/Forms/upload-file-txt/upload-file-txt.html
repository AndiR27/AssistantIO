<form (ngSubmit)="onSubmit()" class="upload-form">

  <div class="file-upload-section">
    <input type="file" id="txtFile" #fileInputRef (change)="onFileSelected($event)" accept=".txt" hidden />

    <button mat-raised-button type="button" color="accent" class="choose-file-btn" (click)="fileInputRef.click()">
      <mat-icon>attach_file</mat-icon>
      <span>{{ file ? 'Changer de fichier' : 'Choisir un fichier .txt' }}</span>
    </button>

    @if (file) {
    <div class="file-info">
      <mat-chip class="file-chip">
        <mat-icon matChipAvatar>description</mat-icon>
        {{ file.name }}
      </mat-chip>
      @if (lineCount() !== null) {
      <span class="line-count">{{ lineCount() }} ligne(s) détectée(s)</span>
      }
    </div>
    }
  </div>

  <div class="form-actions">
    <button mat-raised-button color="primary" class="submit-btn" type="submit" [disabled]="!file || isUploading">
      @if (isUploading) {
      <ng-container>
        <mat-icon class="spinning">sync</mat-icon>
        <span>Import en cours...</span>
      </ng-container>
      } @else {
      <ng-container>
        <mat-icon>cloud_upload</mat-icon>
        <span>Importer les étudiants</span>
      </ng-container>
      }
    </button>
  </div>

  @if (lineCount() !== null && !isUploading && !file) {
  <div class="success-message">
    <mat-icon>check_circle</mat-icon>
    <span>{{ lineCount() }} étudiant{{ lineCount()! > 1 ? 's' : '' }} importé{{ lineCount()! > 1 ? 's' : '' }} avec
      succès !</span>
  </div>
  }
</form>